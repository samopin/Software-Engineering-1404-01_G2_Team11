{% extends "team10/base.html" %}
{% block title %}Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ± | Ø§ÛŒØ±Ø§Ù†â€ŒÙ†Ù…Ø§{% endblock %}

{% block content %}
<section class="t10-page">
  <section class="t10-section">
    <h2>Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ±</h2>
    <p>Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„ÛŒ Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø³ÙØ±.</p>
  </section>

  {% if trip %}
        <div class="trip-details-card">
            <div class="trip-info-grid">
                <div class="info-item">
                    <span class="label">Ù…Ù‚ØµØ¯</span>
                    <span class="value">{{ trip.destination_name|default:trip.requirements.destination_name }}</span>
                </div>
                <div class="info-item">
                    <span class="label">Ù…Ø¯Øª</span>
                    <span class="value">{{ days_count }} Ø±ÙˆØ²</span>
                </div>
                <div class="info-item">
                    <span class="label">ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹</span>
                    <span class="value">{{ start_at_jalali|default:"â€”" }}</span>
                </div>
                <div class="info-item">
                    <span class="label">ÙˆØ¶Ø¹ÛŒØª</span>
                    <span class="value">{{ trip.get_status_display }}</span>
                </div>
                <div class="info-item">
                    <span class="label">ØªØ¹Ø¯Ø§Ø¯ Ù†ÙØ±</span>
                    <span class="value">{{ trip.requirements.travelers_count }}</span>
                </div>
                <div class="info-item">
                    <span class="label">Ø³Ø·Ø­ Ø¨ÙˆØ¯Ø¬Ù‡</span>
                    <span class="value">{{ trip.requirements.get_budget_level_display|default:"â€”" }}</span>
                </div>
                <div class="info-item">
                    <span class="label">Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù„</span>
                    <span class="value">{{ total_cost|floatformat:0|default:"â€”" }} ØªÙˆÙ…Ø§Ù†</span>
                </div>
            </div>
        </div>

  <section class="t10-card">
    <h3>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡</h3>

    {% for day in days_list %}
    <div class="t10-day-block" style="margin-bottom: 2rem; border: 1px solid #e0e0e0; border-radius: 8px; padding: 1rem;">
      <h4 style="background: #f5f5f5; padding: 0.5rem 1rem; margin: -1rem -1rem 1rem -1rem; border-radius: 8px 8px 0 0;">
        Ø±ÙˆØ² {{ day.day_number }} - {{ day.date_jalali }}
      </h4>
      
      {% for item in day.activities %}
      
      {% if item.transfer %}
      <div class="t10-transfer-info" style="background: #e8f4fd; padding: 0.5rem 1rem; margin: 0.5rem 0; border-radius: 4px; border-right: 3px solid #2196f3;">
        <span style="color: #1976d2;">
          <strong>ğŸš— Ø§Ù†ØªÙ‚Ø§Ù„:</strong>
          {% if item.transfer.transport_mode == "WALKING" %}
            Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ
          {% elif item.transfer.transport_mode == "TAXI" %}
            ØªØ§Ú©Ø³ÛŒ
          {% elif item.transfer.transport_mode == "PUBLIC_TRANSIT" %}
            Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„ Ø¹Ù…ÙˆÙ…ÛŒ
          {% elif item.transfer.transport_mode == "DRIVING" %}
            Ø®ÙˆØ¯Ø±Ùˆ Ø´Ø®ØµÛŒ
          {% else %}
            {{ item.transfer.transport_mode }}
          {% endif %}
          | {{ item.transfer.distance_km }} Ú©ÛŒÙ„ÙˆÙ…ØªØ±
          | {{ item.transfer.duration_minutes }} Ø¯Ù‚ÛŒÙ‚Ù‡
          {% if item.transfer.cost > 0 %}
          | Ù‡Ø²ÛŒÙ†Ù‡: {{ item.transfer.cost|floatformat:0 }} ØªÙˆÙ…Ø§Ù†
          {% endif %}
        </span>
      </div>
      {% endif %}
      
      <div class="t10-item-row" style="padding: 0.75rem; background: #fafafa; border-radius: 4px; margin-bottom: 0.5rem;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
          <div><strong>ÙØ¹Ø§Ù„ÛŒØª:</strong> {{ item.plan.description|truncatechars:50|default:"-" }}</div>
          <div><strong>Ù†ÙˆØ¹:</strong> {{ item.activity_type_fa }}</div>
          <div><strong>Ø³Ø§Ø¹Øª:</strong> {{ item.plan.start_at|date:"H:i" }} ØªØ§ {{ item.plan.end_at|date:"H:i" }}</div>
          <div><strong>Ù‡Ø²ÛŒÙ†Ù‡:</strong> {{ item.plan.cost|floatformat:0|default:"0" }} ØªÙˆÙ…Ø§Ù†</div>
        </div>
      </div>
      
      {% endfor %}
    </div>
    {% empty %}
    <div class="t10-day-block">
      <div class="t10-item-row">
        <div>Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø³ÙØ± Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>
      </div>
    </div>
    {% endfor %}
  </section>

  <section class="t10-card">
    <h3>Ù‡ØªÙ„â€ŒÙ‡Ø§</h3>
    {% for hotel in hotel_schedules %}
    <div class="t10-day-block">
      <div class="t10-item-row">
        <div><strong>Ø´Ù†Ø§Ø³Ù‡ Ù‡ØªÙ„:</strong> {{ hotel.hotel_id }}</div>
        <div><strong>ØªØ¹Ø¯Ø§Ø¯ Ø§ØªØ§Ù‚:</strong> {{ hotel.rooms_count }}</div>
        <div><strong>Ù‡Ø²ÛŒÙ†Ù‡:</strong> {{ hotel.cost|floatformat:0 }} ØªÙˆÙ…Ø§Ù†</div>
      </div>
      <div class="t10-transfer">
        Ø¨Ø§Ø²Ù‡ Ø§Ù‚Ø§Ù…Øª: {{ hotel.start_at_jalali|default:"-" }} ØªØ§ {{ hotel.end_at_jalali|default:"-" }}
      </div>
    </div>
    {% empty %}
    <div class="t10-day-block">
      <div class="t10-item-row">
        <div>Ù‡ØªÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø³ÙØ± Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>
      </div>
    </div>
    {% endfor %}
  </section>

  <div class="t10-actions">
    <a class="t10-btn t10-btn--secondary" href="{% url 'team10:trip_cost' trip.id %}">Ù‡Ø²ÛŒÙ†Ù‡ Ø³ÙØ±</a>
    <a class="t10-btn t10-btn--secondary" href="{% url 'team10:trip_styles' trip.id %}">Ø³Ø¨Ú©â€ŒÙ‡Ø§</a>
    <a class="t10-btn t10-btn--primary" href="{% url 'team10:trip_replan' trip.id %}">Ø¨Ø§Ø²ØªÙˆÙ„ÛŒØ¯ Ø¨Ø±Ù†Ø§Ù…Ù‡</a>
  </div>
  {% else %}
  <section class="t10-card">
    <h3>Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ±</h3>
    <p>Ø³ÙØ± Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.</p>
  </section>
  {% endif %}
</section>
{% endblock %}
