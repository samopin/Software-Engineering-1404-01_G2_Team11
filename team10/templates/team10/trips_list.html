{% extends "team10/base.html" %}
{% load static %}
{% block title %}سفرهای من | ایران‌نما{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/persian-datepicker@latest/dist/css/persian-datepicker.min.css">
{% endblock %}

{% block content %}
{% with status=request.GET.status|default:"همه" date_from=request.GET.date_from|default:"" date_to=request.GET.date_to|default:"" destination=request.GET.destination|default:"" q=request.GET.q|default:"" sort=request.GET.sort|default:"جدیدترین" %}

<div class="page-header">
    <h2>سفرهای من</h2>
    <p>فهرست سفرها با فیلتر و جستجو</p>
</div>

<section class="t10-filter-box">
    <form method="get" class="t10-filter-form">
        <div class="t10-filter-grid">
            <div class="t10-field">
                <label for="status">وضعیت</label>
                <select id="status" name="status">
                    <option value="همه" {% if status == "همه" %}selected{% endif %}>همه</option>
                    <option value="پیشنویس" {% if status == "پیشنویس" %}selected{% endif %}>پیشنویس</option>
                    <option value="فعال" {% if status == "فعال" %}selected{% endif %}>فعال</option>
                    <option value="تمام‌شده" {% if status == "تمام‌شده" %}selected{% endif %}>تمام‌شده</option>
                    <option value="لغو شده" {% if status == "لغو شده" %}selected{% endif %}>لغو شده</option>
                </select>
            </div>

            <div class="t10-field">
                <label for="date-from">بازه تاریخ شروع (از)</label>
                <div class="t10-input-with-icon">
                    <input id="date-from" type="text" name="date_from" class="t10-jalali-input persian-date"
                           value="{{ date_from }}" placeholder="۱۴۰۴-۰۱-۰۱" autocomplete="off">
                    <i class="fas fa-calendar-alt t10-calendar-icon"></i>
                </div>
            </div>

            <div class="t10-field">
                <label for="date-to">بازه تاریخ شروع (تا)</label>
                <div class="t10-input-with-icon">
                    <input id="date-to" type="text" name="date_to" class="t10-jalali-input persian-date"
                           value="{{ date_to }}" placeholder="۱۴۰۴-۱۲-۲۹" autocomplete="off">
                    <i class="fas fa-calendar-alt t10-calendar-icon"></i>
                </div>
            </div>

            <div class="t10-field">
                <label for="destination">مقصد</label>
                <input id="destination" type="text" name="destination" value="{{ destination }}" placeholder="مثال: شیراز">
            </div>
        </div>

        <div class="t10-filter-grid t10-filter-grid--secondary">
            <div class="t10-field t10-field--wide">
                <label for="q">جستجو در مقصد یا کد سفر</label>
                <input id="q" type="text" name="q" value="{{ q }}" placeholder="مثال: شیراز یا کد-۱۰۲">
            </div>

            <div class="t10-field">
                <label for="sort">مرتب‌سازی</label>
                <select id="sort" name="sort">
                    <option value="جدیدترین" {% if sort == "جدیدترین" %}selected{% endif %}>جدیدترین</option>
                    <option value="قدیمی‌ترین" {% if sort == "قدیمی‌ترین" %}selected{% endif %}>قدیمی‌ترین</option>
                    <option value="هزینه" {% if sort == "هزینه" %}selected{% endif %}>هزینه</option>
                </select>
            </div>
        </div>

        <div class="t10-actions">
            <button type="submit" class="t10-btn t10-btn--secondary">جستجو</button>
        </div>
    </form>
</section>

<section class="t10-trip-table-wrap">
    <table class="t10-trip-table">
        <thead>
            <tr>
                <th>کد سفر</th>
                <th>مبدأ</th>
                <th>مقصد</th>
                <th>تاریخ شروع شمسی</th>
                <th>مدت (روز)</th>
                <th>بودجه (تومان)</th>
                <th>وضعیت</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody>

        {% if sort == "قدیمی‌ترین" %}

            {% if status == "همه" or status == "تمام‌شده" %}
                {% if not date_from or "1404-02-10" >= date_from %}
                    {% if not date_to or "1404-02-10" <= date_to %}
                        {% if not destination or destination in "شیراز" %}
                            {% if not q or q in "شیراز" or q in "کد-۱۰۱" %}
                                <tr>
                                    <td>کد-۱۰۱</td><td>تهران</td><td>شیراز</td><td>1404-02-10</td><td>۴</td><td>۱۲٬۰۰۰٬۰۰۰</td>
                                    <td><span class="t10-badge t10-badge--done">تمام‌شده</span></td>
                                    <td><a class="t10-btn t10-btn--secondary" href="/team10/trips/1/">مشاهده جزئیات</a></td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}

            {% if status == "همه" or status == "فعال" %}
                {% if not date_from or "1404-03-22" >= date_from %}
                    {% if not date_to or "1404-03-22" <= date_to %}
                        {% if not destination or destination in "تبریز" %}
                            {% if not q or q in "تبریز" or q in "کد-۱۰۲" %}
                                <tr>
                                    <td>کد-۱۰۲</td><td>اصفهان</td><td>تبریز</td><td>1404-03-22</td><td>۳</td><td>۹٬۵۰۰٬۰۰۰</td>
                                    <td><span class="t10-badge t10-badge--active">فعال</span></td>
                                    <td><a class="t10-btn t10-btn--secondary" href="/team10/trips/2/">مشاهده جزئیات</a></td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}

            {% if status == "همه" or status == "پیشنویس" %}
                {% if not date_from or "1404-05-08" >= date_from %}
                    {% if not date_to or "1404-05-08" <= date_to %}
                        {% if not destination or destination in "کیش" %}
                            {% if not q or q in "کیش" or q in "کد-۱۰۳" %}
                                <tr>
                                    <td>کد-۱۰۳</td><td>مشهد</td><td>کیش</td><td>1404-05-08</td><td>۵</td><td>۱۸٬۳۰۰٬۰۰۰</td>
                                    <td><span class="t10-badge t10-badge--draft">پیشنویس</span></td>
                                    <td><a class="t10-btn t10-btn--secondary" href="/team10/trips/3/">مشاهده جزئیات</a></td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}

        {% elif sort == "هزینه" %}

            {% if status == "همه" or status == "پیشنویس" %}
                {% if not date_from or "1404-05-08" >= date_from %}
                    {% if not date_to or "1404-05-08" <= date_to %}
                        {% if not destination or destination in "کیش" %}
                            {% if not q or q in "کیش" or q in "کد-۱۰۳" %}
                                <tr>
                                    <td>کد-۱۰۳</td><td>مشهد</td><td>کیش</td><td>1404-05-08</td><td>۵</td><td>۱۸٬۳۰۰٬۰۰۰</td>
                                    <td><span class="t10-badge t10-badge--draft">پیشنویس</span></td>
                                    <td><a class="t10-btn t10-btn--secondary" href="/team10/trips/3/">مشاهده جزئیات</a></td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}

            {% if status == "همه" or status == "تمام‌شده" %}
                {% if not date_from or "1404-02-10" >= date_from %}
                    {% if not date_to or "1404-02-10" <= date_to %}
                        {% if not destination or destination in "شیراز" %}
                            {% if not q or q in "شیراز" or q in "کد-۱۰۱" %}
                                <tr>
                                    <td>کد-۱۰۱</td><td>تهران</td><td>شیراز</td><td>1404-02-10</td><td>۴</td><td>۱۲٬۰۰۰٬۰۰۰</td>
                                    <td><span class="t10-badge t10-badge--done">تمام‌شده</span></td>
                                    <td><a class="t10-btn t10-btn--secondary" href="/team10/trips/1/">مشاهده جزئیات</a></td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}

            {% if status == "همه" or status == "فعال" %}
                {% if not date_from or "1404-03-22" >= date_from %}
                    {% if not date_to or "1404-03-22" <= date_to %}
                        {% if not destination or destination in "تبریز" %}
                            {% if not q or q in "تبریز" or q in "کد-۱۰۲" %}
                                <tr>
                                    <td>کد-۱۰۲</td><td>اصفهان</td><td>تبریز</td><td>1404-03-22</td><td>۳</td><td>۹٬۵۰۰٬۰۰۰</td>
                                    <td><span class="t10-badge t10-badge--active">فعال</span></td>
                                    <td><a class="t10-btn t10-btn--secondary" href="/team10/trips/2/">مشاهده جزئیات</a></td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}

        {% else %}

            {% if status == "همه" or status == "پیشنویس" %}
                {% if not date_from or "1404-05-08" >= date_from %}
                    {% if not date_to or "1404-05-08" <= date_to %}
                        {% if not destination or destination in "کیش" %}
                            {% if not q or q in "کیش" or q in "کد-۱۰۳" %}
                                <tr>
                                    <td>کد-۱۰۳</td><td>مشهد</td><td>کیش</td><td>1404-05-08</td><td>۵</td><td>۱۸٬۳۰۰٬۰۰۰</td>
                                    <td><span class="t10-badge t10-badge--draft">پیشنویس</span></td>
                                    <td><a class="t10-btn t10-btn--secondary" href="/team10/trips/3/">مشاهده جزئیات</a></td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}

            {% if status == "همه" or status == "فعال" %}
                {% if not date_from or "1404-03-22" >= date_from %}
                    {% if not date_to or "1404-03-22" <= date_to %}
                        {% if not destination or destination in "تبریز" %}
                            {% if not q or q in "تبریز" or q in "کد-۱۰۲" %}
                                <tr>
                                    <td>کد-۱۰۲</td><td>اصفهان</td><td>تبریز</td><td>1404-03-22</td><td>۳</td><td>۹٬۵۰۰٬۰۰۰</td>
                                    <td><span class="t10-badge t10-badge--active">فعال</span></td>
                                    <td><a class="t10-btn t10-btn--secondary" href="/team10/trips/2/">مشاهده جزئیات</a></td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}

            {% if status == "همه" or status == "تمام‌شده" %}
                {% if not date_from or "1404-02-10" >= date_from %}
                    {% if not date_to or "1404-02-10" <= date_to %}
                        {% if not destination or destination in "شیراز" %}
                            {% if not q or q in "شیراز" or q in "کد-۱۰۱" %}
                                <tr>
                                    <td>کد-۱۰۱</td><td>تهران</td><td>شیراز</td><td>1404-02-10</td><td>۴</td><td>۱۲٬۰۰۰٬۰۰۰</td>
                                    <td><span class="t10-badge t10-badge--done">تمام‌شده</span></td>
                                    <td><a class="t10-btn t10-btn--secondary" href="/team10/trips/1/">مشاهده جزئیات</a></td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}

        {% endif %}
        </tbody>
    </table>
</section>

{% endwith %}
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://unpkg.com/persian-date@latest/dist/persian-date.min.js"></script>
<script src="https://unpkg.com/persian-datepicker@latest/dist/js/persian-datepicker.min.js"></script>
<script>
  $(document).ready(function () {
    const options = {
      observer: true,
      format: 'YYYY-MM-DD',
      autoClose: true,
      initialValue: false,
      toolbox: { calendarSwitch: { enabled: false } },
      timePicker: { enabled: false }
    };

    $('#date-from').persianDatepicker(options);
    $('#date-to').persianDatepicker(options);

    $('.t10-jalali-input').on('focus', function () {
      $(this).persianDatepicker('show');
    });

    $('.t10-calendar-icon').on('click', function () {
      $(this).siblings('.t10-jalali-input').focus();
    });
  });
</script>
{% endblock %}
