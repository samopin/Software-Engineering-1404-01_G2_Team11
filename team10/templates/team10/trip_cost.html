{% extends "team10/base.html" %}
{% block title %}هزینه سفر | ایران‌نما{% endblock %}

{% block content %}
<section class="t10-page">
  <section class="t10-section">
    <h2>هزینه سفر</h2>
    <p>تحلیل هزینه‌های سفر شما به {{ trip.destination_name|default:"مقصد" }}</p>
  </section>

  {% if trip %}
  <section class="t10-card">
    <h3>دسته‌بندی هزینه‌ها</h3>
    <div class="t10-cost-list">
      {% for item in cost_breakdown %}
      {% if item.cost > 0 %}
      <div class="t10-cost-row">
        <span>{{ item.name }}</span>
        <span>{{ item.percent }}٪</span>
        <strong>{{ item.cost|floatformat:0 }} تومان</strong>
      </div>
      {% endif %}
      {% empty %}
      <div class="t10-cost-row">
        <span>هزینه‌ای ثبت نشده است.</span>
      </div>
      {% endfor %}
    </div>
  </section>

  <section class="t10-card t10-cost-summary">
    <div><strong>جمع هزینه:</strong> {{ total_cost|floatformat:0 }} تومان</div>
    <div><strong>سطح بودجه:</strong>
      {% with b=trip.requirements.get_budget_level_display|default:"" %}
        {% with b_lower=b|lower %}
          {% if b_lower == "economy" or b_lower == "economic" or b_lower == "economical" %}
            اقتصادی
          {% elif b_lower == "medium" or b_lower == "normal" or b_lower == "standard" or b_lower == "moderate" %}
            متوسط
          {% elif b_lower == "luxury" or b_lower == "lux" %}
            لوکس
          {% else %}
            —
          {% endif %}
        {% endwith %}
      {% endwith %}
    </div>
  </section>

  <section class="t10-section">
    <h3>جزئیات هزینه</h3>
    
    {% if hotel_details %}
    <details class="t10-details">
      <summary>اقامت</summary>
      <ul>
        {% for item in hotel_details %}
        <li>{{ item.description }} - {{ item.cost|floatformat:0 }} تومان</li>
        {% endfor %}
      </ul>
    </details>
    {% endif %}

    {% if transport_details %}
    <details class="t10-details">
      <summary>حمل‌ونقل</summary>
      <ul>
        {% for item in transport_details %}
        <li>{{ item.description|truncatechars:50 }} - {{ item.cost|floatformat:0 }} تومان</li>
        {% endfor %}
      </ul>
    </details>
    {% endif %}

    {% if food_details %}
    <details class="t10-details">
      <summary>خوراک</summary>
      <ul>
        {% for item in food_details %}
        <li>{{ item.description|truncatechars:50 }} - {{ item.cost|floatformat:0 }} تومان</li>
        {% endfor %}
      </ul>
    </details>
    {% endif %}

    {% if sightseeing_details %}
    <details class="t10-details">
      <summary>بازدید و فرهنگی</summary>
      <ul>
        {% for item in sightseeing_details %}
        <li>{{ item.description|truncatechars:50 }} - {{ item.cost|floatformat:0 }} تومان</li>
        {% endfor %}
      </ul>
    </details>
    {% endif %}

    {% if other_details %}
    <details class="t10-details">
      <summary>تفریحی/سایر</summary>
      <ul>
        {% for item in other_details %}
        <li>{{ item.description|truncatechars:50 }} - {{ item.cost|floatformat:0 }} تومان</li>
        {% endfor %}
      </ul>
    </details>
    {% endif %}

    {% if not hotel_details and not transport_details and not food_details and not sightseeing_details and not other_details %}
    <p>جزئیات هزینه‌ای برای این سفر ثبت نشده است.</p>
    {% endif %}
  </section>

  <div class="t10-actions">
    <a class="t10-btn t10-btn--secondary" href="{% url 'team10:trip_detail' trip_id %}">بازگشت به جزئیات سفر</a>
  </div>

  {% else %}
  <section class="t10-card">
    <p>سفر موردنظر یافت نشد.</p>
  </section>
  {% endif %}
</section>
{% endblock %}
